// Prisma schema for Rental Management System
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User model for system administrators
model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  email     String   @unique
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

// Tenant (Inquilino) model
model Tenant {
  id                    Int          @id @default(autoincrement())
  firstName             String
  lastName              String
  phone                 String?
  documentId            String       @unique // DNI, Cedula, etc.
  address               String?
  birthDate             DateTime?
  numeroLocal           String?      // Número de local comercial
  rubro                 Rubro?       // Rubro del negocio
  fechaInicioContrato   DateTime?    // Fecha de inicio del contrato de alquiler
  estadoPago            EstadoPago   @default(AL_DIA) // Estado de pagos del inquilino
  status                TenantStatus @default(ACTIVE) // Soft delete/status
  deletedAt             DateTime?    // Soft delete timestamp
  createdAt             DateTime     @default(now())
  updatedAt             DateTime     @updatedAt

  // Relations
  properties            Property[]
  payments              Payment[]
  rentals               Rental[] // Legacy relation

  @@map("tenants")
}

// Property (Propiedad/Inmueble) model
model Property {
  id          Int         @id @default(autoincrement())
  name        String
  address     String
  city        String
  state       String
  zipCode     String?
  propertyType PropertyType
  bedrooms    Int?
  bathrooms   Float?
  areaSqm     Float?
  monthlyRent Decimal
  description String?
  isAvailable Boolean     @default(true)
  status      PropertyStatus @default(ACTIVE) // Property status
  deletedAt   DateTime?    // Soft delete timestamp
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  // Relations
  tenantId    Int
  tenant      Tenant      @relation(fields: [tenantId], references: [id], onDelete: Restrict)
  payments    Payment[]
  rentals     Rental[] // Legacy relation

  @@map("properties")
}

// Rental (Alquiler/Contrato) model - DEPRECATED
// Mantained for backwards compatibility but not used in new relationships
model Rental {
  id            Int            @id @default(autoincrement())
  tenantId      Int
  propertyId    Int
  startDate     DateTime
  endDate       DateTime?
  monthlyRent   Decimal
  depositAmount Decimal?
  status        RentalStatus   @default(ACTIVE)
  notes         String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  // Relations (legacy)
  tenant        Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  property      Property       @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@unique([tenantId, propertyId, startDate])
  @@map("rentals")
}

// Payment (Pago) model
model Payment {
  id          Int          @id @default(autoincrement())
  tenantId    Int
  propertyId  Int
  amount      Decimal
  paymentDate DateTime     @default(now())
  dueDate     DateTime
  paymentType PaymentType
  status      PaymentStatus @default(PENDING)
  notes       String?
  deletedAt   DateTime?    // Soft delete timestamp
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  // Relations - NO CASCADE: Los pagos históricos se mantienen
  tenant      Tenant       @relation(fields: [tenantId], references: [id], onDelete: Restrict)
  property    Property     @relation(fields: [propertyId], references: [id], onDelete: Restrict)

  @@map("payments")
}

// Enums
enum PropertyType {
  APARTMENT
  HOUSE
  STUDIO
  OFFICE
  COMMERCIAL
  LAND
}

enum PropertyStatus {
  ACTIVE      // Propiedad activa y alquilable
  INACTIVE    // Propiedad temporalmente inactiva
  ARCHIVED    // Propiedad archivada (soft delete)
}

enum TenantStatus {
  ACTIVE      // Inquilino activo
  INACTIVE    // Inquilino inactivo
  ARCHIVED    // Inquilino archivado (soft delete)
}

enum EstadoPago {
  AL_DIA      // Sin deudas pendientes
  CON_DEUDA   // Tiene meses con deuda
}

enum Rubro {
  TIPEO
  PEDICURE
}

enum RentalStatus {
  ACTIVE
  COMPLETED
  CANCELLED
  TERMINATED
}

enum PaymentType {
  RENT
  DEPOSIT
  MAINTENANCE
  LATE_FEE
  OTHER
}

enum PaymentStatus {
  PENDING
  COMPLETED
  OVERDUE
  CANCELLED
}
