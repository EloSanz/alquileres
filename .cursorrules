# ü§ñ REGLAS PARA PROGRAMACI√ìN AGENTICA (OBLIGATORIO)

**LEE AGENT_RULES.md PRIMERO**: https://github.com/tu-repo/AGENT_RULES.md

Este archivo es un resumen. Las reglas completas est√°n en AGENT_RULES.md

## üö´ PROHIBICIONES ABSOLUTAS

### Backend - NUNCA uses:
- ‚ùå Express, NestJS, Fastify
- ‚ùå Axios, Fetch nativo
- ‚ùå TypeORM, MikroORM, Sequelize
- ‚ùå Joi, Yup, Zod
- ‚ùå Librer√≠as de mapeo autom√°tico
- ‚ùå Implementaciones sin interfaces

### Frontend - NUNCA uses:
- ‚ùå Axios, Fetch nativo, Eden Fetch
- ‚ùå Carpeta `/src/types/` (excepto tipos compartidos m√≠nimos)
- ‚ùå Redux, Zustand, Jotai
- ‚ùå CSS Modules, styled-components

## ‚úÖ STACK OBLIGATORIO

- **Backend**: Elysia + Prisma + PostgreSQL + TypeScript
- **Frontend**: React + Vite + Eden Treaty + Material UI + TypeScript
- **Type-Safety**: Eden Treaty (inferencia autom√°tica end-to-end)

## üîÑ DESPU√âS DE CADA CAMBIO (OBLIGATORIO)

```bash
# Siempre ejecutar despu√©s de modificar c√≥digo:
cd server && npm run type-check && npm run build
cd ../web && npm run type-check && npm run build
```

## üìã CHECKLIST ANTES DE COMMIT

```bash
# Backend
[ ] export type App = typeof app en src/index.ts
[ ] grep -r "interface I.*Service" src/interfaces/
[ ] grep -r "interface I.*Repository" src/interfaces/
[ ] grep -r "toDTO()" src/entities/
[ ] grep -r "fromPrisma()" src/entities/
[ ] ‚ö†Ô∏è CR√çTICO: Verificar que schemas de validaci√≥n incluyan TODOS los campos de los DTOs
[ ] ‚ö†Ô∏è Si modificaste un DTO, verificar que el schema en routes/*.routes.ts est√© actualizado
[ ] npm run type-check ‚úÖ && npm run build ‚úÖ (verificaci√≥n final)

# Frontend
[ ] treaty<App> de @elysiajs/eden
[ ] import type { App } from '../../../server/src/index'
[ ] NO carpeta src/types/ (excepto m√≠nimos)
[ ] npm run type-check ‚úÖ && npm run build ‚úÖ (verificaci√≥n final)
```

## ‚ö†Ô∏è LECCI√ìN CR√çTICA: Validaci√≥n de Schemas en Elysia

**PROBLEMA**: Si un campo opcional no llega al controller aunque se env√≠e desde frontend.

**CAUSA**: Elysia FILTRA campos que no est√°n en el schema de validaci√≥n, incluso si son opcionales.

**SOLUCI√ìN**: 
- Si agregas un campo a `UpdateXDTO`, **DEBES agregarlo al schema** con `t.Optional()`.
- **Siempre verificar**: Schema de validaci√≥n ‚Üî DTO deben estar sincronizados.

**Ejemplo**:
```typescript
// ‚ùå INCORRECTO - status se filtra aunque se env√≠e
const updatePaymentBodySchema = t.Object({
  amount: t.Optional(t.Number()),
  paymentDate: t.Optional(t.String())
  // status falta aqu√≠
});

// ‚úÖ CORRECTO - incluir TODOS los campos
const updatePaymentBodySchema = t.Object({
  amount: t.Optional(t.Number()),
  paymentDate: t.Optional(t.String()),
  status: t.Optional(t.String()) // ‚úÖ DEBE estar
});
```

## üìö DOCUMENTACI√ìN

1. **AGENT_RULES.md** - Reglas completas con templates para copiar/pegar
2. **QUICK_REFERENCE.md** - Referencia t√©cnica y comandos
3. **ARCHITECTURE_STANDARD.md** - Est√°ndar completo
4. **C√≥digo real** - `server/` y `web/` como referencia de implementaci√≥n

## üöÄ SETUP R√ÅPIDO

```bash
# Setup completo
./setup.sh

# Desarrollo
npm run dev  # Backend + Frontend simult√°neo
```

## ‚ö†Ô∏è SI NO SIGUES ESTAS REGLAS

**DETENTE. NO PROGRAMES.**

Este est√°ndar funciona completo o no se usa. Copia los templates exactamente.

